{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://genaptitude.local/schemas/v1/common/types/primitive-types.schema.json",
  "title": "Primitive Types (GenAptitude)",
  "type": "object",
  "$defs": {
    "instanceSchemaUri": {
      "title": "Instance $schema URI",
      "description": "Chemin RELATIF au répertoire schemas/v1 (ex: actors/actor.schema.json).",
      "type": "string",
      "format": "uri-reference",
      "pattern": "^(?:\\.\\./)*(?:[A-Za-z0-9_\\-]+/)+[A-Za-z0-9_\\-]+\\.schema\\.json$"
    },
    "_id": {
      "title": "Identifiant (UUID)",
      "description": "Identifiant unique au format UUID v4. Généré automatiquement si absent.",
      "type": "string",
      "pattern": "^[A-Za-z0-9._:-]{1,128}$",
      "format": "uuid",
      "x_compute": {
        "update": "if_missing",
        "plan": { "op": "uuid_v4" }
      }
    },
    "x_emoji": {
      "title": "Emoji",
      "type": "string",
      "minLength": 1
    },
    "nonEmptyString": {
      "title": "Non-empty string",
      "type": "string",
      "minLength": 1
    },
    "i18nNonEmptyString": {
      "title": "I18n string (either plain string or map of locales)",
      "oneOf": [
        {
          "type": "string",
          "minLength": 1
        },
        {
          "type": "object",
          "minProperties": 1,
          "additionalProperties": {
            "type": "string",
            "minLength": 1
          }
        }
      ]
    },
    "slug": {
      "title": "Slug",
      "type": "string",
      "pattern": "^[a-z0-9]([a-z0-9-_]*[a-z0-9])?$",
      "minLength": 1
    },
    "uuid": {
      "title": "UUID",
      "type": "string",
      "format": "uuid"
    },
    "DomainName": {
      "title": "Domain name",
      "type": "string",
      "format": "hostname"
    },
    "uri": {
      "title": "URI",
      "type": "string",
      "format": "uri"
    },
    "uriReference": {
      "title": "URI reference",
      "type": "string",
      "format": "uri-reference"
    },
    "url": {
      "title": "URL",
      "type": "string",
      "format": "uri"
    },
    "dateTime": {
      "title": "RFC3339 date-time",
      "type": "string",
      "format": "date-time"
    },
    "createdAt": {
      "title": "Horodatage de création. RFC3339 date-time",
      "type": "string",
      "format": "date-time",
      "x_compute": {
        "update": "if_missing",
        "plan": { "op": "now_rfc3339" }
      }
    },
    "updatedAt": {
      "title": "Dernière mise à jour. RFC3339 date-time",
      "type": "string",
      "format": "date-time",
      "x_compute": {
        "update": "always",
        "plan": { "op": "now_rfc3339" }
      }
    },

    "version": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$",
      "default": "1.0.0"
    },
    "semver": {
      "type": "string",
      "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-[0-9A-Za-z.-]+)?(?:\\+[0-9A-Za-z.-]+)?$"
    },
    "email": {
      "title": "Email",
      "type": "string",
      "format": "email",
      "examples": ["user@example.com"]
    },
    "phoneE164": {
      "title": "Phone (E.164)",
      "type": "string",
      "pattern": "^\\+[1-9]\\d{1,14}$",
      "examples": ["+33123456789", "+15551234567"]
    },
    "languageTag": {
      "title": "BCP 47 language tag",
      "type": "string",
      "pattern": "^[A-Za-z]{2,3}(-[A-Za-z0-9]{2,8})*$",
      "examples": ["fr", "en-US", "pt-BR"]
    },
    "locale": {
      "title": "Locale (BCP 47)",
      "allOf": [{ "$ref": "#/$defs/languageTag" }],
      "examples": ["fr", "fr-FR", "en-US"]
    },
    "percent0to100": {
      "type": "number",
      "minimum": 0,
      "maximum": 100
    },
    "percent0to1": {
      "type": "number",
      "minimum": 0,
      "maximum": 1
    },
    "euroAmount": {
      "type": "number",
      "minimum": 0
    },
    "quantity": {
      "type": "number",
      "minimum": 0
    },

    "db_itemRef": {
      "oneOf": [
        { "type": "string", "pattern": "^(?:[A-Za-z0-9_\\-]+/)+[A-Za-z0-9_\\-]+\\.json$" },
        {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "file": {
              "type": "string",
              "pattern": "^(?:[A-Za-z0-9_\\-]+/)+[A-Za-z0-9_\\-]+\\.json$"
            }
          },
          "required": ["file"]
        }
      ]
    },

    "db_collection": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "schema": {
          "type": "string",
          "description": "Chemin RELATIF à libs/core_schemas/schemas/v1/ (pas de préfixe 'schemas/v1/').",
          "pattern": "^(?:[A-Za-z0-9_\\-]+/)+[A-Za-z0-9_\\-]+\\.schema\\.json$"
        },
        "items": {
          "type": "array",
          "items": { "$ref": "#/$defs/db_itemRef" },
          "default": []
        }
      },
      "required": ["schema", "items"]
    }
  },
  "examples": [{}]
}
